# PowerKey

PowerKey 是一个基于 Windows 的功能键快捷启动工具，利用 F1-F12 组合键快速呼出指定文件夹、程序或快捷方式，提升键盘党效率。

## 主要特性

### 快捷键功能
- **Fx + Enter**：打开 `C:\Users\<用户名>\AppData\Local\Power Keys\Fx` 对应目录（自动创建）
- **Fx + 字母/数字**：执行该目录中同名的快捷方式或文件
- **智能拦截**：不常用功能键（F1、F6-F10）被拦截用于快捷启动，常用功能键（F2 重命名、F3 搜索、F4 关闭、F5 刷新、F11 全屏、F12 控制台）直接放行
- **Fn + Fx 不受影响**：键盘固件级 Fn 逻辑原样生效

### 游戏模式
- **Win + Esc**：切换游戏模式，暂停或恢复所有 PowerKey 功能，避免游戏中误触
- 游戏模式开启时会显示通知提示

### 系统控制
- **Win + F3**：切换系统托盘图标显示/隐藏
- **Win + F4**：退出程序
- **左键点击托盘图标**：重启程序
- **右键点击托盘图标**：显示菜单
  - 开机自启动（开启/关闭）
  - 隐藏托盘
  - 退出程序

### 长期稳定性
- 内置心跳检测机制，每 5 分钟自动刷新键盘监听钩子，确保长时间运行不失效
- 无日志输出，静默运行，不影响用户体验

## 安装与使用

### 方式一：直接运行可执行文件
1. 下载 `PowerKey.exe`
2. 双击运行即可（建议右键"以管理员身份运行"）
3. 程序会自动创建快捷方式目录并在系统托盘显示图标

### 方式二：从源码运行
1. 克隆仓库并安装依赖：
   ```powershell
   git clone https://github.com/yourname/PowerKey.git
   cd PowerKey
   pip install -r requirements.txt
   ```

2. 运行程序：
   ```powershell
   python main.py
   ```

3. 可选：打包成独立可执行文件：
   ```powershell
   build.bat
   ```
   生成的 `PowerKey.exe` 可直接在 Windows 上使用

> ⚠️ **注意**：程序需要监听全局键盘事件，建议以管理员权限运行以确保功能正常

## 使用教程

### 快捷方式设置
1. 运行程序后，会在 `C:\Users\<用户名>\AppData\Local\Power Keys` 自动创建 F1-F12 对应的文件夹
2. 将你想要快速启动的程序快捷方式（.lnk）或文件放入对应文件夹
3. 快捷方式命名规则：
   - 使用单个字母命名：`a.lnk`、`b.lnk` 等
   - 使用单个数字命名：`1.lnk`、`2.lnk` 等
4. 使用时按下 `Fx + 字母/数字` 即可启动

### 示例配置
假设你想设置以下快捷启动：
- F1 + A：启动 Chrome 浏览器
- F1 + B：打开记事本
- F2 + 1：启动 VSCode

操作步骤：
1. 按 `F1 + Enter` 打开 F1 目录
2. 创建 Chrome 快捷方式，命名为 `a.lnk`
3. 创建记事本快捷方式，命名为 `b.lnk`
4. 按 `F2 + Enter` 打开 F2 目录
5. 创建 VSCode 快捷方式，命名为 `1.lnk`

现在你可以使用对应的组合键快速启动程序了！

## 配置说明

### config.py 配置项

```python
# 快捷方式存放目录
BASE_PATH = os.path.join(os.environ['LOCALAPPDATA'], 'Power Keys')

# 常用功能键（直接放行，不拦截）
COMMON_F_KEYS = {'f2', 'f3', 'f4', 'f5', 'f11', 'f12'}

# 游戏模式切换热键
GAME_MODE_HOTKEY = 'win+esc'

# 通知显示时间（秒）
NOTIFICATION_DURATION = 3
```

你可以根据需要修改这些配置项来自定义程序行为。

## 文件结构

```
PowerKey/
├── config.py              # 配置与常量
├── shortcut_manager.py    # 快捷方式/文件夹管理
├── keyboard_handler.py    # 键盘监听与组合键逻辑
├── system_tray.py         # 系统托盘图标管理
├── startup_manager.py     # 开机自启动管理
├── main.py                # 程序入口
├── icons.ico              # 程序图标
├── build.bat              # PyInstaller 打包脚本
└── requirements.txt       # 依赖清单
```

## 依赖项

```
keyboard>=0.13.5      # 键盘事件监听
pystray>=0.19.0       # 系统托盘图标
pillow>=10.0.0        # 图像处理
plyer>=2.0.0          # Windows 通知
pyinstaller>=6.0.0    # 打包工具
```

## 常见问题

### Q: 为什么某些快捷键不起作用？
A: 请确保：
1. 程序以管理员权限运行
2. 没有处于游戏模式（游戏模式会禁用所有快捷键）
3. 快捷方式文件命名正确（单个字母或数字）
4. 快捷方式文件有效且可执行

### Q: 程序长时间运行后失效怎么办？
A: 程序已内置心跳检测机制，每 5 分钟自动刷新监听钩子。如果仍然失效，可以左键点击托盘图标重启程序。

### Q: 如何完全退出程序？
A: 有三种方式：
1. 按 `Win + F4`
2. 右键点击托盘图标，选择"退出程序"
3. 在命令行窗口按 `Ctrl + C`

### Q: 托盘图标不见了怎么办？
A: 按 `Win + F3` 可以重新显示托盘图标。

### Q: F2/F5 等常用功能键无法使用怎么办？
A: F2（重命名）、F3（搜索）、F4（关闭）、F5（刷新）、F11（全屏）、F12（控制台）这些常用功能键不会被拦截，可以正常使用。如果仍然无法使用，请检查是否有其他软件占用了这些按键。

### Q: 如何设置开机自启动？
A: 右键点击托盘图标，勾选"开机自启动"即可。程序会自动在 Windows 注册表中添加启动项。

### Q: 为什么打包后程序无法运行？
A: 请确保：
1. 使用 `build.bat` 进行打包
2. `icons.ico` 文件存在于项目根目录
3. 如果有正在运行的 PowerKey.exe，build.bat 会自动关闭它

## 技术说明

### 键盘监听机制
- 使用 `keyboard` 库的 hook 机制监听全局键盘事件
- 不常用功能键使用 `suppress=True` 拦截，常用功能键直接放行
- Win 键组合使用 `suppress=False` 避免阻拦 Win 键本身功能

### 长期稳定性保障
- 心跳线程每 5 分钟静默重新注册所有键盘钩子
- 防止 Windows 系统清理长时间运行的钩子导致失效
- 无日志输出，避免文件膨胀和性能影响

### 通知系统
- 使用 `plyer` 库调用 Windows 原生通知 API
- 不会产生额外的 PowerShell 进程和任务栏图标
- 通知自动在 2 秒后消失

## 许可证 & 图标说明

- 代码以 MIT License 发布
- 软件图标来自 [Icons8](https://icons8.com) 的 [Keyboard](https://icons8.com/icon/124063/keyboard) 图标，感谢其提供的开源资源

## 贡献指南

欢迎提交 Issue 或 Pull Request！如果你有任何建议或发现了 bug，请随时在 GitHub 上提出。

## 更新日志

### v2.0
- 改进功能键拦截逻辑：常用功能键（F2/F3/F4/F5/F11/F12）直接放行
- 添加系统托盘图标支持
- 添加开机自启动功能
- 添加 Win+F3 切换托盘显示
- 添加 Win+F4 退出程序
- 添加左键点击托盘图标重启程序
- 实现心跳检测机制，确保长时间运行稳定性
- 使用 plyer 库改进通知系统，避免 PowerShell 进程出现

### v1.0
- 基础功能键快捷启动功能
- 游戏模式支持
- Fx + Enter 打开文件夹
- Fx + 字母/数字启动快捷方式

